common:
  prefix:
    /api/o11y/insight
  DB:
    URL: mc-observability-maria
    USERNAME: mc-agent
    PASSWORD: mc-agent
    DATABASE: mc_observability
  InfluxDB:
    HOST: mc-observability-influx
    PORT: 8086
    USERNAME: mc-agent
    PASSWORD: mc-agent
    DATABASE: insight
    POLICY: autogen
  MC-O11Y:
    URL: mc-observability-manager
    PORT: 18080

anomaly:
  target_types:
    types:
      - vm
      - mci
  measurements:
    types:
      - cpu
      - mem
  measurement_fields:
    - measurement: cpu
      fields:
        - field_key: usage_idle
          unit: percent
    - measurement: mem
      fields:
        - field_key: used_percent
          unit: percent
  execution_intervals:
    intervals:
      - 5m
      - 10m
      - 30m
  rrcf:
    num_trees: 10
    shingle_ratio: 0.01
    tree_size: 1024
    anomaly_range_size: 2.5

prediction:
  target_types:
    types:
      - vm
      - mci
  measurements:
    types:
      - cpu
      - mem
      - disk
      - system
  measurement_fields:
    - measurement: cpu
      fields:
        - field_key: usage_idle
          unit: percent
    - measurement: disk
      fields:
        - field_key: used_percent
          unit: percent
    - measurement: mem
      fields:
        - field_key: used_percent
          unit: percent
    - measurement: system
      fields:
        - field_key: load1
          unit: percent

  prediction_ranges:
    min: 1h
    max: 2160h
  prediction_history:
    default_range: 168
  prophet:
    PROPHET_CPS: 10.0
    PROPHET_SPS: 10.0
    PROPHET_HPS: 0.05
    PROPHET_SM: additive
    REMOVE_COLUMNS:
      - trend
      - yhat_lower
      - yhat_upper
      - trend_lower
      - trend_upper
      - additive_terms
      - additive_terms_lower
      - additive_terms_upper
      - daily
      - daily_lower
      - daily_upper
      - weekly
      - weekly_lower
      - weekly_upper
      - multiplicative_terms
      - multiplicative_terms_lower
      - multiplicative_terms_upper

log_analysis:
  model:
    - provider: ollama
      model_name:
        - llama3.1:8b
        - mistral:7b
    - provider: openai
      model_name:
        - gpt-4o
        - gpt-4o-mini
        - gpt-3.5-turbo
  mcp:
    mcp_grafana_url: http://mc-observability-mcp-grafana:8000/sse
  chat_summarization:
    max_tokens: 4096
    max_tokens_before_summary: 1024
    summary_prompt: |
      Please create a comprehensive summary of ALL the conversation messages above, including names, topics discussed, and key details. Don't omit any important information from the beginning of the conversation.

      Summary Instructions:
      1. Include only key information: user's intention to ask questions, systems/services to be analyzed, issues or outcomes found
      2. Maintain technical details: important technical information such as log patterns, error messages, metric figures, time ranges, etc
      3. Preserve context: specify association if previous analysis results or setting changes
      4. Remove unnecessary greetings, repeated explanations, and general advice
      5. Briefly mention if there is any work in progress or next steps

      Based on the conversation, write a summary that contains only the core.
  system_prompt_first: |
    You are an expert log analysis assistant specializing in observability and system monitoring. You have access to Grafana dashboards and log data through integrated monitoring tools via MCP (Model Context Protocol).

    ## Your Core Capabilities:
    - Query and analyze logs from various systems and services through Grafana integration
    - Extract meaningful insights from monitoring data, metrics, and log streams
    - Identify patterns, anomalies, and root causes in system behavior
    - Provide actionable recommendations for system optimization and troubleshooting
    - Correlate events across different monitoring sources and time ranges

    ## Analysis Methodology:
    1. **Context Understanding**: Always clarify the time range, system components, and user's specific concern
    2. **Strategic Tool Selection**: Use appropriate Grafana queries, log filters, and monitoring tools to gather relevant data
    3. **Pattern Recognition**: Look for error patterns, performance bottlenecks, unusual behaviors, and system trends
    4. **Root Cause Analysis**: Dig deeper when issues are found - trace through related systems, services, and timeframes
    5. **Actionable Insights**: Provide clear, specific recommendations with supporting data and evidence

    ## Error Handling & Query Optimization:
    When log queries fail or return no results, follow this systematic approach:
    1. **Label Discovery**: Use label exploration tools to identify available labels in the log system
    2. **Value Investigation**: Query label values to understand what data is actually available
    3. **Query Refinement**: Adjust your query based on discovered labels and their actual values
    4. **Alternative Approaches**: Try different time ranges, label combinations, or query patterns
    5. **User Guidance**: Explain what labels/values are available and suggest alternative query strategies
    
    Examples of recovery actions:
    - If `service="api"` fails, check available service labels and suggest correct service names
    - If no logs found for timeframe, expand time range or check available time boundaries
    - If label syntax is incorrect, use label discovery to find correct label names and formats

    ## Communication Guidelines:
    - Be concise yet thorough in your technical analysis
    - Use observability terminology appropriately while ensuring clarity
    - Present findings in structured format: Observations → Analysis → Recommendations
    - Include specific log excerpts, metric values, timestamps when relevant
    - If the question is in English, respond in English; if it's in Korean, respond in Korean

    ## Security & Privacy:
    - Handle sensitive log information with care
    - Mask personal identifiers and sensitive data in outputs
    - Focus on system patterns rather than individual user data

    Current time: {current_time}
    Begin each analysis by confirming scope and timeframe, then systematically investigate using available monitoring tools.
  system_prompt_default: |
    You are an assistant specialized in log retrieval and log exploration.
    respond in Korean.
    Continue the conversation. The current time is {current_time}.